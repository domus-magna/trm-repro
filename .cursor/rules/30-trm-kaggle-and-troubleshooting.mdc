---
alwaysApply: true
description: Kaggle publishing steps and troubleshooting checklist for TRM ARC-AGI-2
---

## Kaggle Publishing (optional but in scope)

```bash
if [ "${PUBLISH_TO_KAGGLE:-0}" = "1" ]; then
  command -v kaggle >/dev/null || pip install kaggle
  [ -f "$HOME/.kaggle/kaggle.json" ] || { echo "Missing ~/.kaggle/kaggle.json"; exit 5; }
  chmod 600 "$HOME/.kaggle/kaggle.json" || true

  rm -rf "$KAGGLE_DS_DIR"
  mkdir -p "$KAGGLE_DS_DIR"
  cp -v "$CKPT" "$KAGGLE_DS_DIR/model.ckpt"

  cat > "$KAGGLE_DS_DIR/dataset-metadata.json" <<EOF
{
  "title": "TRM ARC-AGI-2 Weights (${RUN_NAME})",
  "id": "${KAGGLE_USERNAME}/${KAGGLE_DATASET_SLUG}",
  "licenses": [{"name": "cc-by-4.0"}]
}
EOF

  cat > "$KAGGLE_DS_DIR/README.md" <<'EOF'
# TRM Weights (Paper-Faithful, ARC-AGI-2)
- Source: SamsungSAILMontreal/TinyRecursiveModels (upstream, no modifications)
- Contents: `model.ckpt` (final checkpoint)
- Usage: In a Kaggle Notebook, attach this Dataset, clone TRM, and load the checkpoint for inference/eval.
EOF

  if kaggle datasets create -p "$KAGGLE_DS_DIR"; then
    echo "Kaggle dataset created: ${KAGGLE_USERNAME}/${KAGGLE_DATASET_SLUG}"
  else
    kaggle datasets version -p "$KAGGLE_DS_DIR" -m "update ${RUN_NAME}"
    echo "Kaggle dataset versioned: ${KAGGLE_USERNAME}/${KAGGLE_DATASET_SLUG}"
  fi
fi
```

### Handoff to Kaggle Notebook
1. New Notebook → Add Data → attach `/${KAGGLE_USERNAME}/${KAGGLE_DATASET_SLUG}`.
2. `git clone` TRM repo; `pip install -r requirements.txt`.
3. Load `/kaggle/input/<slug>/model.ckpt` with TRM code; run eval/inference.

## Troubleshooting
- **Torch install mismatch**: set correct `TORCH_INDEX_URL` for your CUDA; use CPU wheels if needed.
- **Python 3.10 missing**: install Python 3.10; do not proceed with 3.11/3.12.
- **Dataset inputs missing**: ensure `kaggle/combined/arc-agi` prefix exists with `training2`, `evaluation2`, `concept` subsets exactly as upstream.
- **CUDA OOM**: on multi-GPU, you may reduce `MAX_GPUS_TO_USE` while keeping training flags intact; on single-GPU OOM, stop and report.
- **Kaggle auth error (401/403)**: re-download API token from Kaggle → Account → API; place at `~/.kaggle/kaggle.json`, `chmod 600`.
- **No checkpoint found**: training likely failed; review logs, re-run step 5.

## Repro Checklist
- [ ] `TARGET_DATASET=arc2` and never changed.
- [ ] TRM cloned; commit recorded in `runs/$RUN_NAME/TRM_COMMIT.txt`.
- [ ] `data/arc2concept-aug-1000/` built via exact builder command.
- [ ] Training command exactly matches step 5 flags.
- [ ] Final checkpoint path captured; `COMMANDS.txt` written.
- [ ] Environment log saved under `.repro/`.
- [ ] Kaggle Dataset created/versioned (if `PUBLISH_TO_KAGGLE=1`).
- [ ] `artifacts/MANIFEST.txt` written with key paths.